{% extends "base.html" %}
{% block head %}
    {% block title %}
        <title>Game</title>
    {% endblock title %}
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
{% endblock head %}
{% block style %}
<style>
	#image-map {
	  width: 1000px;
	  height: 1000px;
	  border: 1px solid #ccc;
	  margin:10px;
	}
</style>
{% endblock %}

{% block content %}
	<div id="image-map"></div>
	<button type="button" onclick="getAllMarkers();">Pop Up All Marker Dimensions</button>
    <label id="RegionName">Region Name</label>
    <label id="techLevel">Technical Level</label>
    <label id="coordinate">Coordinate</label>
{% endblock content %}
{% block scripts %}
<script>
	// create the slippy map
	var map = L.map('image-map', {
	  minZoom: 1,
	  maxZoom: 4,
	  center: [0, 0],
	  zoom: 1,
	  crs: L.CRS.Simple
	});
	// dimensions and url of the image
	var w = 2048,
	    h = 2048,
	    url = '/static/images_regions/background.jpg';

	//make custom icon
    var star_icon = L.icon({
        iconUrl: 'static/star2.png',
        iconSize: [38, 38], // size of the icon
        popupAnchor: [0,-15]
        });
    var customOptions =
        {
        'maxWidth': '1000',
        }
    //var marker = L.marker([-100, 100]).addTo(map);
    {% for i in range(0,len) %}

        var customPopup = "{{ game.universe.regions[i].name }}<br/>Cost: {{ game.calculate_cost_to(game.universe.regions[i]) }}<br/><button id = \"travel\" class=\"btn btn-primary\" onclick=\"myFunction()\"/>Travel</button>";
        var marker{{i}} = L.marker([{{ -(game.universe.regions[i].coordinates[0] + 200) }}, {{ (game.universe.regions[i].coordinates[1] + 200) }}],{icon: star_icon}).bindPopup(customPopup,customOptions).addTo(map);
        var travelButton = document.getElementById('travel');
        travelButton.addEventListener("click", function () {
            url = {{ game.universe.regions[i].image_name }};
             var clickMeButton = document.createElement('button');
             clickMeButton.innerHTML = 'Back to the Map';
             var body = document.getElementsByTagName("content");
             body.appendChild(clickMeButton);
            document.getElementById('RegionName').innerText = {{ game.universe.regions[i].name }};
            document.getElementById('techLevel').innerText = {{ game.universe.regions[i].techLevel }};
            document.getElementById('coordinate').innerText = {{ game.universe.regions[i].coordinates }}
        })
    {%  endfor %}
    map.on('click', function(e) {
        alert(e.latlng);
    } );

	// calculate the edges of the image, in coordinate space
	var southWest = map.unproject([0, h], map.getMaxZoom()-2);
	var northEast = map.unproject([w, 0], map.getMaxZoom()-2);

	var bounds = new L.LatLngBounds(southWest, northEast);
	L.imageOverlay(url, bounds).addTo(map);
	map.setMaxBounds(bounds);
	function getAllMarkers() {
	    var allMarkersObjArray = [];//new Array();
        {% for i in range(0,len) %}
            allMarkersObjArray.push(marker{{i}}._latlng);
        {%  endfor %}
	    alert(JSON.stringify(allMarkersObjArray));
	    console.log(JSON.stringify(allMarkersObjArray));
	}
</script>
{% endblock scripts %}